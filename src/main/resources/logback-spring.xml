<?xml version="1.0" encoding="UTF-8"?>
<configuration>

  <!-- 공통 설정: dev/prod 둘 다에서 사용하는 부분 -->
  <!-- 로그 파일이 저장될 기본 경로를 지정 -->
  <property name="LOG_PATH" value="./.logs"/>

  <!-- 로그 출력 형식(pattern)을 정의 -->
  <!-- 예시: 2026-02-03 15:35:01.123 [main] INFO com.example.DemoApplication - 로그 메시지 -->
  <property name="LOG_PATTERN"
    value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight(%-5level) %yellow(%logger{36}) [%X{request_id:-} | %X{request_method:-} | %X{request_url:-}] - %msg%n"/>

  <!-- 콘솔에 로그를 출력하는 Appender 설정 -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <!-- 콘솔 로그 출력 형식 지정 -->
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- 파일로 로그를 저장하는 Appender 설정 -->
  <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <!-- 현재 활성 로그 파일의 위치 및 이름 정의 -->
    <file>${LOG_PATH}/application.log</file>

    <!-- 로그 파일의 롤링(파일 교체) 정책 설정 -->
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <!-- 날짜별로 새로운 로그 파일을 생성 -->
      <!-- 예시: application.2026-02-03.log -->
      <fileNamePattern>${LOG_PATH}/application.%d{yyyy-MM-dd}.log</fileNamePattern>

      <!-- 최대 30일치 로그 파일 보관, 이후 자동 삭제 -->
      <maxHistory>30</maxHistory>
    </rollingPolicy>

    <encoder>
      <!-- 파일 로그 출력 형식 지정 -->
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- dev 환경 전용 로그 설정 -->
  <springProfile name="dev">
    <!-- 개발 환경에서는 DEBUG 이상을 남겨서 디버깅에 유리하게 설정 -->
    <root level="DEBUG">
      <appender-ref ref="CONSOLE"/>
      <appender-ref ref="FILE"/>
    </root>
  </springProfile>

  <!-- prod 환경 전용 로그 설정 -->
  <springProfile name="prod">
    <!-- 운영 환경에서는 INFO 이상만 로그로 남겨서 불필요한 로그를 줄임 -->
    <root level="INFO">
      <appender-ref ref="CONSOLE"/>
      <appender-ref ref="FILE"/>
    </root>
  </springProfile>
</configuration>
